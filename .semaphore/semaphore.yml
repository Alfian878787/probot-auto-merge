version: v1.0
name: probot-auto-merge
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Installing
    task:
      prologue:
        commands:
          - checkout
          - cache restore
      jobs:
        - name: install
          commands:
            - nvm install v$NODE_VERSION
            - sem-version node $NODE_VERSION
            - npm install
      epilogue:
        on_pass:
          commands:
            - cache store
      env_vars:
        - name: NODE_VERSION
          value: 10.16.3
    dependencies: []
  - name: Testing
    task:
      prologue:
        commands:
          - checkout
          - cache restore
      jobs:
        - name: test
          commands:
            - npm run test
    dependencies:
      - Installing
  - name: Releasing
    dependencies:
      - Building
      - Linting
      - Testing
    task:
      prologue:
        commands:
          - checkout
          - cache restore
      jobs:
        - name: Release
          commands:
            - npm run semantic-release
  - name: Building
    dependencies:
      - Installing
    task:
      prologue:
        commands:
          - checkout
          - cache restore
      jobs:
        - name: build
          commands:
            - npm run build
  - name: Linting
    dependencies:
      - Installing
    task:
      prologue:
        commands:
          - checkout
          - cache restore
      jobs:
        - name: lint
          commands:
            - npm run lint
